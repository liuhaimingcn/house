<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.house.mapper.single.SingleMapper" >
    <resultMap id="BaseResultMap" type="com.house.api.model.Single" >
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="title" property="title" jdbcType="VARCHAR" />
        <result column="created_on" property="createdOn" jdbcType="TIMESTAMP" />
        <result column="updated_on" property="updatedOn" jdbcType="TIMESTAMP" />
        <result column="status" property="status" jdbcType="INTEGER" />
    </resultMap>

    <resultMap id="DetailResultMap" type="com.house.api.model.Single" extends="BaseResultMap">
        <collection property="detailList" resultMap="com.house.mapper.detail.DetailMapper.BaseResultMap" columnPrefix="detail_"/>
    </resultMap>

    <sql id="Base_Column_List" >
        id, title, created_on, updated_on, status
    </sql>

    <update id="modify" parameterType="com.house.api.model.Single" >
        update single
        <set >
            <if test="title != null" >
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="status != null" >
                status = #{status,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>

    <insert id="add" parameterType="com.house.api.model.Single" useGeneratedKeys="true" keyProperty="id">
        insert into single (id, title, created_on)
        values (#{id,jdbcType=VARCHAR}, #{title,jdbcType=VARCHAR}, #{createdOn,jdbcType=TIMESTAMP})
    </insert>

    <select id="getSingleList" parameterType="com.house.api.commons.base.PageVo" resultMap="BaseResultMap">
        select <include refid="Base_Column_List" />
        from single
        where status = 1
        order by created_on desc
        <if test="isPaging != 0">
            limit #{from},#{size}
        </if>
    </select>

    <select id="getSingleCount" resultType="long">
        select count(1) total from single t1
        where t1.status = 1
    </select>

    <select id="getDetailList" parameterType="com.house.api.commons.base.PageVo" resultMap="DetailResultMap">
        select t1.*, t2.id detail_id, t2.picture detail_picture, t2.title detail_title
        from single t1 left join detail t2 on t1.id = t2.single_id
        where t1.status = 1 and t1.id = #{entity.id}
        <if test="isPaging != 0">
            limit #{from},#{size}
        </if>
    </select>

    <select id="getDetailCount" resultType="long">
        select count(1)
        from single t1 left join detail t2 on t1.id = t2.single_id
        where t1.status = 1 and t1.id = #{entity.id}
    </select>

</mapper>